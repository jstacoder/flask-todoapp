{% extends 'layout.html' %}
{% from 'macros.html' import icon %}
{% from 'macros.html' import get_priority_label as label %}
{% block content %}
    <div class="row">
        <div class="col-md-3">
            <h3 class="lead">Category</h3>
                <div class=row>
                    <div class="col-md-10 col-md-push-1 well well-sm">            
                        <div class=row>
                            <div class="col-md-3 col-md-offset-4">
                                <p>Edit</p>
                            </div>
                            <div class="col-md-3 col-md-pull-0">
                                <p>Delete</p>
                            </div>
                            <div class="col-md-9 col-md-push-2">
                                <hr class="well-hr" />
                            </div>
                        </div>
               {%- for category in categories %}
                        <div class="row">
                             <div class=col-md-4>
                                <a
                                  class="btn btn-link cat-btn"
                                  href="{{ url_for('list_todos', name=category.name) }}">
                                    {{ category.name }}
                                </a>
                            </div>
                             <div class=col-md-4>
                                <a
                                   class="btn btn-link cat-btn" href="{{ url_for('edit_category', category_id=category.id) }}">
                                    {{ icon('edit','fa') }}
                                </a>
                             </div>
                             <div class="col-md-pull-1 col-md-3">
                                <form id="catdel-{{ category.name }}" action="{{ url_for('delete_category', category_id=category.id) }}" method="post">
                                <a class="btn btn-link text-danger cat-btn" onclick="$('#catdel-{{ category.name }}').submit();">{{ icon('trash-o','fa') }}</a>
                                </form>
                             </div>
                        </div>                    
                {%- endfor %}
                    </div>
                </div>        
        </div>
        <div class="col-md-9">
            {% if todos|count > 0 %}
            <h3 class="lead">Todos</h3>
            <table id="todo-table" class="table table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Description</th>
                        <th>Category</th>
                        <th>Priority</th>
                        <th>Creation date</th>
                        <th class="text-center">Edit</th>
                        <th class="text-center">Delete</th>
                        <th>Complete/undo</th>
                    </tr>
                </thead>
                <tbody>
                    {%- for todo in todos %}
                        <tr {% if todo.is_done %}class="success"{% endif %}>
                            <td> {{ loop.index }} </td>
                            <td {% if todo.is_done %}style="text-decoration:line-through"{% endif %}>{{ todo.description }}</td>
                            <td>{{ todo.category.name }}</td>
                            <td>{{ label(todo.priority.name) }}</td>
                            <td>{{ todo.creation_date }}</td>
                            <td class=last-td>
                                <a class="btn btn-link{% if todo.is_done %} disabled{% endif %}"  href="{{ url_for('update_todo', todo_id=todo.id) }}" >{{ icon('pencil fa-border','fa') }}</a>
                            </td>
                            <td class=last-td>
                               <form id="delform-{{ todo.id }}" action="{{ url_for('delete_todo', todo_id=todo.id) }}" method="post">
                                <a onclick="$('#delform-{{ todo.id }}').submit();" class="btn btn-link text-danger" id="delete_todo" href="#">{{ icon('trash-o fa-border','fa') }}</a>
                              </form>
                            </td>
                            <td class="last-td">
                                {% if not todo.is_done %}
                                    <form id="isdone-{{ todo.id }}" action="{{ url_for('mark_done', todo_id=todo.id) }}" method="post">
                                        <a onclick="$('#isdone-{{ todo.id }}').submit()" class="btn btn-link" id="mark_done">{{ icon('check fa-border','fa') }}</a>
                                    </form>
                                {% else %}
                                    <form id="undone-{{ todo.id }}" action="{{ url_for('un_mark_done', todo_id=todo.id) }}" method="post">
                                        <a onclick="$('#undone-{{ todo.id }}').submit()" class="btn btn-link text-warning" id="undo">{{ icon('retweet fa-border','fa') }}</a>
                                    </form>
                                {% endif %}
                            </td>
                        </tr>
                    {%- endfor %}
                </tbody>
            </table>
            {% else %}
            <h3 class=lead>No Todos Yet</h3>
            {% endif %}
        </div>
    </div>
{% endblock %}
